---
description: Best practices for Prisma schema design, model definitions, relations, and database mapping
globs: prisma/schema.prisma, **/*.prisma
---

# Prisma Schema Best Practices

## Model Naming

- Use **PascalCase** for model names (e.g., `User`, `BlogPost`, `OrderItem`).
- Use **camelCase** for field names (e.g., `firstName`, `createdAt`, `isActive`).
- Use **SCREAMING_SNAKE_CASE** for enum values (e.g., `ADMIN`, `IN_PROGRESS`).
- Choose meaningful, domain-specific names that clearly describe the entity.
- Avoid abbreviations unless they are universally understood (e.g., `URL`, `API`).

## Primary Keys

- Always define an `@id` field on every model.
- Use `@default(cuid())` or `@default(uuid())` for string-based IDs:
  ```prisma
  model User {
    id String @id @default(cuid())
  }
  ```
- Use `@default(autoincrement())` only when integer IDs are explicitly required.

## Timestamp Fields

- **Always** add `createdAt` and `updatedAt` fields to every model:
  ```prisma
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  ```
- Use `@updatedAt` so Prisma automatically sets the timestamp on every update.
- These fields are essential for auditing, debugging, and data management.

## Model-Level Documentation

- Add triple-slash `///` doc comments above models and fields to document purpose and business logic:
  ```prisma
  /// Represents a registered user in the system.
  /// Tracks authentication, profile, and role information.
  model User {
    /// Unique identifier — CUID for distributed safety
    id        String   @id @default(cuid())
    /// User's primary email — used for login and notifications
    email     String   @unique
    /// Display name shown in the UI
    name      String?
    role      Role     @default(USER)
    posts     Post[]
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
  }
  ```
- Document non-obvious constraints, business rules, and the rationale behind design choices.
- Use model-level comments to explain relationships and access patterns.

## Enums

- Use enums for fields with a fixed set of values:
  ```prisma
  enum Role {
    ADMIN
    USER
    MODERATOR
  }

  enum OrderStatus {
    PENDING
    PROCESSING
    SHIPPED
    DELIVERED
    CANCELLED
  }
  ```
- Prefer enums over free-form strings to enforce data integrity at the schema level.
- Add `@map` to enum values if the database representation differs from the Prisma name.

## Relations

- Define **explicit relation names** for clarity, especially when a model has multiple relations to the same target:
  ```prisma
  model Post {
    author   User @relation("PostAuthor", fields: [authorId], references: [id])
    authorId String
    editor   User? @relation("PostEditor", fields: [editorId], references: [id])
    editorId String?
  }
  ```
- Always specify `fields` and `references` on the owning side of the relation.
- Configure proper **referential actions** using `onDelete` and `onUpdate`:
  ```prisma
  author User @relation(fields: [authorId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  ```
- Choose referential actions intentionally based on domain logic:
  - `Cascade` — delete/update child when parent is deleted/updated (e.g., posts when user is deleted)
  - `SetNull` — set FK to null when parent is removed (e.g., optional editor)
  - `Restrict` — prevent deletion of parent if children exist (e.g., protect categories with products)
  - `NoAction` — defer constraint check to the database (useful with deferred constraints)
- **Always** specify `onDelete` explicitly — relying on database defaults leads to surprises.

## Indexes

- Use `@@index` for fields that are frequently queried or filtered:
  ```prisma
  @@index([email])
  @@index([status, createdAt])
  ```
- Add composite indexes for queries that filter on multiple columns together.
- Use `@@unique` for compound unique constraints:
  ```prisma
  @@unique([tenantId, email])
  ```
- Index all foreign key fields — Prisma does not auto-create FK indexes for all databases.
- Use `@@fulltext` for full-text search indexes where supported:
  ```prisma
  @@fulltext([title, content])
  ```

## Database Mapping

- Use `@map` on fields and `@@map` on models to follow database naming conventions (e.g., snake_case) while keeping Prisma models in PascalCase/camelCase:
  ```prisma
  model UserProfile {
    firstName String @map("first_name")
    lastName  String @map("last_name")

    @@map("user_profiles")
  }
  ```
- Map enum names and values when the database convention differs:
  ```prisma
  enum UserRole {
    ADMIN     @map("admin")
    MODERATOR @map("moderator")
    USER      @map("user")

    @@map("user_role")
  }
  ```

## Native Type Annotations

- Use `@db` native type annotations to control the exact database column type:
  ```prisma
  model Product {
    price    Decimal  @db.Decimal(10, 2)
    bio      String   @db.Text
    metadata Json     @db.JsonB
    avatar   Bytes    @db.ByteA
  }
  ```
- This ensures the generated migration matches your performance and storage requirements.

## Composite Types (MongoDB)

- Use composite types wisely for embedded documents in MongoDB schemas:
  ```prisma
  type Address {
    street  String
    city    String
    state   String
    zipCode String @map("zip_code")
    country String
  }

  model User {
    id      String  @id @default(auto()) @map("_id") @db.ObjectId
    address Address
  }
  ```
- Prefer composite types for data that is always read/written with its parent document.
- Avoid deeply nested composite types — flatten when possible for query simplicity.
- Do **not** use composite types for data that needs to be queried independently — use a separate model with a relation instead.

## General Guidelines

- Keep the schema file organized: group related models together.
- Add `///` comments to complex relations or business logic encoded in the schema.
- Use `datasource` and `generator` blocks at the top of the schema file.
- Enable `previewFeatures` only when needed and document why.
- Use `prisma format` regularly to keep the schema consistently formatted.
- Validate the schema before committing with `prisma validate`.
